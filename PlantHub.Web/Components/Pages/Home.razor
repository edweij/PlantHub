@page "/"
@rendermode InteractiveServer
@using PlantHub.Web.Lib
@inject IHomeAssistantClient HA

@if (!HA.IsEnabled)
{
    <p style="color:orange">
        Home Assistant is disabled (no SUPERVISOR_TOKEN and no HA:BaseUrl/Token).
    </p>
}

<h3>PlantHub (Areas)</h3>

<button type="button" @onclick="LoadAreas">Load Areas</button>

@if (_areas is null)
{
    <p><em>Klicka ”Load Areas”.</em></p>
}
else if (_areas.Count == 0)
{
    <p>Inga areas hittades.</p>
}
else
{
    <ul>
        @foreach (var a in _areas)
        {
            <li>
                @a.Name (<code>@a.Id</code>) @((a.FloorId is { Length: > 0 }) ? $"— {a.FloorId}" : "")
            </li>
        }
    </ul>
}

@code {
    private List<HaAreaLite>? _areas;

    private async Task LoadAreas()
    {
        var list = await HA.GetAreasAsync();
        // valfri sortering: våning → namn
        _areas = list
            .OrderBy(a => a.FloorId ?? "zzz")
            .ThenBy(a => a.Name)
            .ToList();
    }
}
