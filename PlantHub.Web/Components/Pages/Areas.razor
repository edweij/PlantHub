@page "/areas"
@using PlantHub.Web.Lib
@inject PlantHub.Web.Lib.IHomeAssistantClient Ha

<h2>Areas (MVP)</h2>

@if (_loading)
{
    <p>Läser in…</p>
}
else if (!Ha.IsEnabled)
{
    <p style="color:orange">HA-klienten är inaktiverad (saknar base URL/token).</p>
}
else if (_error is not null)
{
    <p style="color:red">Fel: @_error</p>
}
else if (_areas.Count == 0)
{
    <p>Inga areas hittades.</p>
}
else
{
    <ul>
        @foreach (var a in _areas)
        {
            <li>@a.Name (@a.Id) @(a.FloorId is null ? "" : $"– Floor: {a.FloorId}")</li>
        }
    </ul>
}

@code {
    private readonly List<HaAreaLite> _areas = new();
    private bool _loading = true;
    private string? _error;

    protected override async Task OnInitializedAsync()
    {
        try
        {
            var list = await Ha.GetAreasAsync();
            _areas.AddRange(list);
        }
        catch (Exception ex)
        {
            _error = ex.Message;
        }
        finally
        {
            _loading = false;
        }
    }
}
